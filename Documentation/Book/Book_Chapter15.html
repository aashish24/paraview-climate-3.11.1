<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
        <META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
        <TITLE>ParaView User's Guide (v3.10)</TITLE>
        <META NAME="GENERATOR" CONTENT="OpenOffice.org 3.2  (Unix)">
        <META NAME="CREATED" CONTENT="0;0">
        <META NAME="CHANGED" CONTENT="0;0">
        <META NAME="Rights" CONTENT="GFDL">
        <STYLE TYPE="text/css">
        <!--
                @page { margin: 0.79in }
                P { margin-bottom: 0.08in }
                EM.western { font-family: "DejaVu Serif", serif }
                EM.cjk { font-style: normal }
                EM.ctl { font-style: normal }
                A:link { so-language: zxx }
        -->
        </STYLE>
</HEAD>
<BODY DIR="LTR">
<DIV ID="CoProcessing" DIR="LTR">
        <P STYLE="margin-bottom: 0.15in; page-break-after: avoid"><FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=6>CoProcessing</FONT></FONT></P>
        <DIV ID="Background " DIR="LTR">
                <P STYLE="margin-top: 0.3in; margin-bottom: 0.15in; page-break-after: avoid">
                <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5 STYLE="font-size: 20pt">Background
                </FONT></FONT>
                </P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>Several factors are
                driving the growth of simulations. Computational power of computer
                clusters is growing while the price of individual computers is
                decreasing. Distributed computing techniques allow hundreds or even
                thousands of computer nodes to participate in a single simulation.
                The benefit of this computational power is that simulations are
                getting more accurate and useful for predicting complex phenomena.
                The downside to this growth in computational power is that enormous
                amounts of data need to be saved and analyzed to determine the
                results of the simulation. The ability to generate data has
                outpaced our ability to save and analyze the data. This bottle neck
                is throttling our ability to benefit from our improved computing
                resources. Simulations save their states only very infrequently to
                minimize storage requirements. This coarse temporal sampling makes
                it difficult to notice some complex behavior. To get past this
                barrier, ParaView can now be easily used to integrate
                post-processing/visualization directly with simulation codes. This
                feature is called co-processing in ParaView and the difference
                between work flows when using co-processing can be seen in the
                differences below. </FONT></FONT>
                </P>
        </DIV>
        <DIV ID="Technical Objectives " DIR="LTR">
                <P STYLE="margin-top: 0.3in; margin-bottom: 0.15in; page-break-after: avoid">
                <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5 STYLE="font-size: 20pt">Technical
                Objectives </FONT></FONT>
                </P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>The main objective of
                the co-processing tool set is to integrate core data processing
                with the simulation to enable scalable data analysis while also
                being simple to use for the analyst. The tool set has two main
                parts: </FONT></FONT>
                </P>
                <UL>
                        <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>An
                        extensible and flexible co-processing library.</B></FONT> The
                        co-processing library was designed to be flexible enough to be
                        embedded in various simulation codes with relative ease. This
                        flexibility is critical, as a library that requires a lot of
                        effort to embed cannot be successfully deployed in a large number
                        of simulations. The co-processing library also is easily extended
                        so that users can easily deploy new analysis and visualization
                        techniques to existing co-processing installations.</FONT></FONT></P>
                        <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>Configuration
                        tools for co-processing configuration.</B></FONT> It is important
                        for the users to be able to configure the co-processor using
                        graphical user interfaces that are part of their daily work-flow. </FONT></FONT>
                        </P>
                </UL>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>Note that all of this
                must be done for large data. The co-processing library will almost
                always be run on a distributed system. For the largest simulations
                the visualization of extracts may also require a distributed system
                (i.e. a visualization cluster). </FONT></FONT>
                </P>
        </DIV>
        <DIV ID="Build Directions " DIR="LTR">
                <P STYLE="margin-top: 0.3in; margin-bottom: 0.15in; page-break-after: avoid">
                <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5 STYLE="font-size: 20pt">Build
                Directions </FONT></FONT>
                </P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>As mentioned above,
                the two components for doing co-processing are a client side plugin
                and a server side library. It is recommended that they be compiled
                separately but from the same ParaView source revision/release. This
                is because currently the client side configuration tools outputs
                python code for the server side library to use. Differing ParaView
                versions may have different python interfaces to objects causing
                simulation co-processed runs to fail. </FONT></FONT>
                </P>
                <DIV ID="ParaView Coprocessing Script Generator Plugin " DIR="LTR">
                        <P STYLE="margin-top: 0.3in; margin-bottom: 0.08in; page-break-after: avoid">
                        <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5>ParaView
                        Coprocessing Script Generator Plugin </FONT></FONT>
                        </P>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>The plugin for
                        generating python scripts for co-processing is a client side
                        plugin. The CMake option to turn on the script generator plugin is
                        PARAVIEW_BUILD_PLUGIN_CoProcessingScriptGenerator. Note that since
                        this is a client side plugin that the PARAVIEW_BUILT_QT_GUI option
                        must be on. </FONT></FONT>
                        </P>
                </DIV>
                <DIV ID="CoProcessing Library " DIR="LTR">
                        <P STYLE="margin-top: 0.3in; margin-bottom: 0.08in; page-break-after: avoid">
                        <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5>CoProcessing
                        Library </FONT></FONT>
                        </P>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>The directions for
                        building the co-processing library can be a bit more complex. We
                        assume that it will be built on a cluster or supercomputer.
                        Complexities may arise from having to build mesa, use off-screen
                        rendering, build static libraries, and/or <A HREF="http://paraview.org/Wiki/Cross_compiling_ParaView3_and_VTK">cross-compiling</A>.
                        We won't go into those details here though but refer interested
                        people to the <A HREF="http://paraview.org/Wiki/ParaView">ParaView</A>
                        and <A HREF="http://www.vtk.org/Wiki/VTK">VTK</A> wikis. </FONT></FONT>
                        </P>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>The additional flags
                        that should be turned on for coprocessing include: </FONT></FONT>
                        </P>
                        <UL>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>BUILD_SHARED_LIBS</B></FONT>
                                Should normally be set to ON unless you're compiling on a machine
                                that doesn't support shared libs (e.g. IBM BG/L).</FONT></FONT></P>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>PARAVIEW_ENABLE_PYTHON</B></FONT>
                                Set to ON in order to use the scripts created from the
                                coprocessing plugin. Note that of the 3.10 release that this is
                                not required to be on though.</FONT></FONT></P>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>PARAVIEW_USE_MPI</B></FONT>
                                Set the ParaView server to use MPI to run in parallel. Also check
                                that the proper version of MPI is getting used.</FONT></FONT></P>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>CMAKE_BUILD_TYPE</B></FONT>
                                Should be set to <EM CLASS="western">Release</EM> in order to
                                optimize the ParaView code.</FONT></FONT></P>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>PARAVIEW_ENABLE_COPROCESSING</B></FONT>
                                The CMake option to build the coprocessing libraries. </FONT></FONT>
                                </P>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>BUILD_COPROCESSING_ADAPTORS</B></FONT>
                                The CMake option to turn on code that may be useful for creating
                                the simulation code adaptor.</FONT></FONT></P>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>BUILD_FORTRAN_COPROCESSING_ADAPTORS</B></FONT>
                                The CMake option to turn on code that may be useful for creating
                                an adaptor for a simulation code written in Fortran or C.</FONT></FONT></P>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>PYTHON_ENABLE_MODULE_vtkCoProcessorPython</B></FONT>
                                On by default.</FONT></FONT></P>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>BUILD_PYTHON_COPROCESSING_ADAPTOR</B></FONT>
                                Experimental code.</FONT></FONT></P>
                        </UL>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <BR><BR>
                        </P>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>If ParaView was
                        build with python enabled, the co-processing library can be tested
                        on the installed system with the CTest command <EM CLASS="western">ctest
                        -R CoProcessing</EM>. The CoProcessingTestPythonScript test does
                        an actual coprocessing run and the
                        CoProcessingPythonScriptGridPlot and
                        CoProcessingPythonScriptPressurePlot test verify the output is
                        correct. In addition, looking at the code for this test is a
                        useful beginning point for learning to use the co-processing
                        library. </FONT></FONT>
                        </P>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>If you are using
                        Mesa, the following options should be used: </FONT></FONT>
                        </P>
                        <UL>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>VTK_OPENGL_HAS_OSMESA</B></FONT>
                                Set to ON.</FONT></FONT></P>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>OSMESA_INCLUDE_DIR,
                                OPENGL_xmesa_INCLUDE_DIR</B></FONT> and <FONT FACE="DejaVu Serif, serif"><B>OPENGL_INCLUDE_DIR</B></FONT>
                                Make sure this is not set to the OpenGL version of the header
                                files.</FONT></FONT></P>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>OSMESA_LIBRARY,
                                OPENGL_gl_LIBRARY</B></FONT> and <FONT FACE="DejaVu Serif, serif"><B>OPENGL_glu_LIBRARY</B></FONT>
                                Set these to the proper libraries.</FONT></FONT></P>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3><FONT FACE="DejaVu Serif, serif"><B>VTK_USE_OFFSCREEN</B></FONT>
                                Set to ON</FONT></FONT></P>
                        </UL>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <BR><BR>
                        </P>
                </DIV>
        </DIV>
        <DIV ID="Running the CoProcessing Script Generator " DIR="LTR">
                <P STYLE="margin-top: 0.3in; margin-bottom: 0.15in; page-break-after: avoid">
                <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5 STYLE="font-size: 20pt">Running
                the CoProcessing Script Generator </FONT></FONT>
                </P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>After starting the
                ParaView client, go to Tools-&gt;Manage Plugins, highlight
                CoProcessingPlugin and click Load Selected. Alternatively, if you
                expect to be using this plugin often you can tell ParaView to
                automatically load the plugin by clicking to the left of
                CoProcessingPlugin to expand the list and choose the Auto Load
                option. This will add a <EM CLASS="western">CoProcessing</EM> and
                <EM CLASS="western">Writers</EM> menu to the GUI.</FONT></FONT></P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>Once the plugin is
                loaded, load a simulation result into ParaView that is similar to
                the run you wish to do co-processing with. Normally the result will
                be for a discretization of the same geometry and contain the same
                field variables (or at least all of the field variables you wish to
                examine) as the simulation grid that co-processing will be
                performed on. The only difference between these two grids will be
                that the grid used for the co-processing run will be at a much
                higher resolution. In the picture below, a pipeline is shown for a
                result from a PHASTA (A CFD code led by Ken Jansen at the
                University of Colorado) simulation of incompressible flow through
                an aortic aneurysm. The simulation results include the velocity and
                pressure fields and was done on a grid with 235,282 cells and
                45,175 points. It is important to use the same names for the field
                arrays as will be used in the grids the coprocessing library will
                be working with. The filters specify which fields to use by their
                name and problems will occur if the filters cannot find the correct
                array. The pipeline computes the vorticity, takes 20 slices through
                the domain, and extracts the surface of the grid. </FONT></FONT>
                </P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <IMG SRC="Book_html_m544e848a.jpg" NAME="128" WIDTH=622 HEIGHT=475 BORDER=0><FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>Once
                the pipeline is set up, the writers must be added to use for the
                filters that results are desired from. This is done by selecting
                the appropriate writer to output the results from each desired
                filter. In this example a ParallelPolyDataWriter is created for the
                Slice filter and the ExtractSurface filter. For the writer for the
                Slice filter we set the name of the file to be <EM CLASS="western">slice_%t.pvtp</EM>
                where %t will get replaced with the time step each time it is
                output. We also set the write frequency to be every fifth time
                step. The picture below shows this. </FONT></FONT>
                </P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <IMG SRC="Book_html_763cb5cc.jpg" NAME="129" WIDTH=622 HEIGHT=887 BORDER=0><FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>Similarly,
                we do the same for the writer for the ExtractSurface filter but we
                want to use a different file name and we can set a different write
                frequency if desired. </FONT></FONT>
                </P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>Note that when we hit
                enter we get the error message <EM CLASS="western">Cannot show the
                data in the current view although the view</EM> reported that it
                can show the data.<EM CLASS="western"> This message can be ignored
                and is already entered as a bug to fix in ParaView.</EM></FONT></FONT></P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>The final step is to
                go through the CoProcessing-&gt;Export State wizard to associate
                the grid with a name that the python script uses and specify a file
                name for the script. The steps are: </FONT></FONT>
                </P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>1. <FONT FACE="DejaVu Serif, serif"><B>Export
                Co-Processing State</B></FONT> Click Next to proceed.</FONT></FONT></P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>2. <FONT FACE="DejaVu Serif, serif"><B>Select
                Simulation Inputs</B></FONT> Choose which grids to use by
                highlighting the grid and clicking Add, then click Next.</FONT></FONT></P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <IMG SRC="Book_html_m1375d3c4.jpg" NAME="130" WIDTH=622 HEIGHT=562 BORDER=0><FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>3.
                <FONT FACE="DejaVu Serif, serif"><B>Name Simulation Inputs</B></FONT>
                Click in the boxes under <EM CLASS="western">Simulation Name</EM>
                and change the name to what you have named the grid in your
                adaptor. Our convention is to use &quot;input&quot; for simulations
                with a single grid or multiblock data set.</FONT></FONT></P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <IMG SRC="Book_html_m47888dc4.jpg" NAME="131" WIDTH=622 HEIGHT=562 BORDER=0><FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>4.
                <FONT FACE="DejaVu Serif, serif"><B>Configuration</B></FONT> We
                usually want the full data and not just a picture of the results so
                for this we leave &quot;Output rendering components i.e. views&quot;
                unchecked and just hit Finish. </FONT></FONT>
                </P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <IMG SRC="Book_html_m25a79b8e.jpg" NAME="132" WIDTH=622 HEIGHT=560 BORDER=0><FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>If
                we do want to output images in addition to any writers we may have
                specified, check &quot;Output rendering components i.e. views&quot;
                and fill in the proper information. Note that the image type is
                specified based on the file name extension and that %t will be
                replaced by the actual time step in the output file name.
                Additionally, if there are multiple views then %v will be replaced
                by the view index in the output file name. </FONT></FONT>
                </P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <IMG SRC="Book_html_292860a.jpg" NAME="133" WIDTH=622 HEIGHT=555 BORDER=0><FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>5.
                <FONT FACE="DejaVu Serif, serif"><B>Save Server State:</B></FONT>
                Specify the file name the script is to be saved as.</FONT></FONT></P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>The resulting python
                script should look something like: </FONT></FONT>
                </P>
                <P STYLE="margin-left: 0.25in; margin-right: 0.25in; margin-top: 0.25in; margin-bottom: 0.25in; background: #e6e6e6; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu mono, monospace"><FONT SIZE=2>try:
                paraview.simple<BR>except: from paraview.simple import
                *<BR><BR>cp_writers = []<BR><BR>def
                RequestDataDescription(datadescription):<BR>    &quot;Callback to
                populate the request for current timestep&quot;<BR>    timestep =
                datadescription.GetTimeStep()<BR><BR><BR>    if (timestep % 5 == 0)
                or (timestep % 200 == 0) :<BR>
                datadescription.GetInputDescriptionByName('input').AllFieldsOn()<BR>

                datadescription.GetInputDescriptionByName('input').GenerateMeshOn()<BR><BR><BR>def
                DoCoProcessing(datadescription):<BR>    &quot;Callback to do
                co-processing for current timestep&quot;<BR>    global cp_writers<BR>
                   cp_writers = []<BR>    timestep =
                datadescription.GetTimeStep()<BR><BR>    grid5_0_vtu =
                CreateProducer( datadescription, &quot;input&quot; )<BR>    <BR>
                GradientOfUnstructuredDataSet1 = GradientOfUnstructuredDataSet(
                guiName=&quot;GradientOfUnstructuredDataSet1&quot;,
                ScalarArray=['POINTS', 'velocity'], ResultArray<BR>Name='Vorticity',
                ComputeVorticity=1, FasterApproximation=0 )<BR>    <BR>    Slice2 =
                Slice( guiName=&quot;Slice2&quot;,
                SliceOffsetValues=[-10.23284210526316, -8.8684631578947375,
                -7.5040842105263152, -6.1397052631578966, -4.77532631578947<BR>43,
                -3.4109473684210529, -2.0465684210526316, -0.68218947368421201,
                0.68218947368420935, 2.0465684210526316, 3.4109473684210521,
                4.7753263157894743, 6.139705<BR>263157893, 7.5040842105263152,
                8.8684631578947375, 10.23284210526316, 11.597221052631578,
                12.961600000000001], SliceType=&quot;Plane&quot; )<BR>    <BR>
                SetActiveSource(GradientOfUnstructuredDataSet1)<BR>
                ExtractSurface1 = ExtractSurface( guiName=&quot;ExtractSurface1&quot;,
                PieceInvariant=1 )<BR>    <BR>    SetActiveSource(Slice2)<BR>
                ParallelPolyDataWriter3 = CreateWriter( XMLPPolyDataWriter,
                &quot;slice_%t.pvtp&quot;, 5 )<BR>    <BR>
                SetActiveSource(ExtractSurface1)<BR>    ParallelPolyDataWriter2 =
                CreateWriter( XMLPPolyDataWriter, &quot;surface_%t.pvtp&quot;, 200
                )<BR>    <BR>    Slice2.SliceType.Origin = [-2.8049160242080688,
                2.1192346811294556, 1.7417440414428711]<BR>
                Slice2.SliceType.Offset = 0.0<BR>    Slice2.SliceType.Normal =
                [0.0, 0.0, 1.0]<BR>    <BR><BR><BR>    for writer in cp_writers:<BR>
                       if timestep % writer.cpFrequency == 0:<BR>
                writer.FileName = writer.cpFileName.replace(&quot;%t&quot;,
                str(timestep))<BR>            writer.UpdatePipeline()<BR><BR>def
                CreateProducer(datadescription, gridname):<BR>  &quot;Creates a
                producer proxy for the grid&quot;<BR>  if not
                datadescription.GetInputDescriptionByName(gridname):<BR>    raise
                RuntimeError, &quot;Simulation input name '%s' does not exist&quot;
                % gridname<BR>  grid =
                datadescription.GetInputDescriptionByName(gridname).GetGrid()<BR>
                producer = TrivialProducer()<BR>
                producer.GetClientSideObject().SetOutput(grid)<BR>
                producer.UpdatePipeline()<BR>  return producer<BR><BR><BR>def
                CreateWriter(proxy_ctor, filename, freq):<BR>    global cp_writers<BR>
                   writer = proxy_ctor()<BR>    writer.FileName = filename<BR>
                writer.add_attribute(&quot;cpFrequency&quot;, freq)<BR>
                writer.add_attribute(&quot;cpFileName&quot;, filename)<BR>
                cp_writers.append(writer)<BR>    return writer</FONT></FONT></P>
        </DIV>
        <DIV ID="Creating the Adaptor " DIR="LTR">
                <P STYLE="margin-top: 0.3in; margin-bottom: 0.15in; page-break-after: avoid">
                <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5 STYLE="font-size: 20pt">Creating
                the Adaptor </FONT></FONT>
                </P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>The largest amount of
                work in getting co-processing working with a simulation code is
                usually creating the adaptor that can pass a VTK data set or
                composite data set with fields specified over it. A simple view of
                the program control is </FONT></FONT>
                </P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <IMG SRC="Book_html_3156ffad.jpg" NAME="134" WIDTH=622 HEIGHT=100 BORDER=0><FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>By
                doing it like this, there is minimal modification to the simulation
                code (only calls to the adaptor like Initialize, Finalize, and
                CoProcess). The adaptor deals with the coprocessing library as well
                as creating VTK data structures from the simulation code as needed.
                The general flow for the simulation code and where it calls the
                adaptor would look like: </FONT></FONT>
                </P>
                <P STYLE="margin-left: 0.25in; margin-right: 0.25in; margin-top: 0.25in; margin-bottom: 0.25in; background: #e6e6e6; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu mono, monospace"><FONT SIZE=2>initialize
                coprocessor for i in number of time steps   compute simulation
                information at time step i   call coprocessing library
                coprocessing library determines if any coprocessing needs to be
                performed at time step i finalize coprocessor</FONT></FONT></P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>The interactions
                between the adaptor and ParaView are mostly done through the
                vtkCPProcessor class. Documentation for this and the other classes
                in the coprocessing library are in the ParaView online
                <A HREF="http://www.paraview.org/ParaView3/Doc/Nightly/html/classes.html">documentation</A>
                as well as grouped in a <A HREF="http://www.paraview.org/ParaView3/Doc/Nightly/html/group__CoProcessing.html">module</A>.
                Details on the specific steps are provided below. </FONT></FONT>
                </P>
                <DIV ID="Initialize the Co-Processor " DIR="LTR">
                        <P STYLE="margin-top: 0.3in; margin-bottom: 0.08in; page-break-after: avoid">
                        <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5>Initialize the
                        Co-Processor </FONT></FONT>
                        </P>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>To initialize the
                        co-processor, a vtkCPProcessor object must be created. This object
                        should not be deleted until the finalization step. After creating
                        a vtkCPProcessor object, you must call
                        vtkCPProcessor::Initialize() to initialize the coprocessing
                        library. The next step is to create vtkCPPipeline objects. These
                        objects are used to represent the VTK pipelines that will be used
                        to generate the output data. Most users will probably only use the
                        vtkCPPythonScriptPipeline class that derives from vtkCPPipeline
                        since that pipeline is the one that is used with the python
                        scripts generated from the coprocessing plugin.
                        vtkCPPythonScriptPipeline::Initialize() takes in the python script
                        name with the full path and sets up the ParaView python
                        interpretor. </FONT></FONT>
                        </P>
                </DIV>
                <DIV ID="Call the Co-Processor to Execute the Desired Filters " DIR="LTR">
                        <P STYLE="margin-top: 0.3in; margin-bottom: 0.08in; page-break-after: avoid">
                        <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5>Call the
                        Co-Processor to Execute the Desired Filters </FONT></FONT>
                        </P>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>Most users will have
                        a single call to the adaptor at the end of each simulation time
                        step. This will pass in the simulation data structures to create
                        the VTK data structures from. The created VTK data structures will
                        be an object that derives from vtkDataObject. First though we want
                        to check if we actually need to do any co-processing during this
                        call. The simulation code will not know this information. Because
                        of this, the simulation code should call the adaptor every time
                        step. The adaptor gets the information about what data is needed
                        for executing the vtkCPPipelines for each call. This is done in
                        vtkCPProcessor::RequestDataDescription() by going through all of
                        the vtkCPPipeline objects and querying them for what is needed.
                        vtkCPProcessor::RequestDataDescription() takes in a
                        vtkCPDataDescription object that contains information about the
                        current simulation time and time step. The method returns 0 if no
                        coprocessing information needs to be computed during the call and
                        1 otherwise. If no coprocessing needs to be performed then the
                        adaptor should return control back to the simulation code. </FONT></FONT>
                        </P>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>If co-processing is
                        requested then the adaptor needs to make sure that the VTK grids
                        and fields are up to date. Upon return from
                        vtkCPProcessor::RequestDataDescription(), the vtkCPDataDescription
                        object will have information on what is needed by the pipelines in
                        order to successfully execute them during this call to the
                        adaptor. This information is stored for each co-processing input
                        (the data objects that are given identifier names in the plugin)
                        and accessed through the vtkCPDataDescription as
                        vtkCPInputDataDescription objects. The vtkCPInputDataDescription
                        objects specify whether or not they require a grid and if so which
                        fields they require. These objects are also used to pass the VTK
                        data objects created in the adaptor to the pipeline by using the
                        vtkCPInputDataDescription::SetGrid() method. The final step in
                        this call to the adaptor is then to perform the actual
                        co-processing by calling the vtkCPProcessor::CoProcess() method. </FONT></FONT>
                        </P>
                </DIV>
                <DIV ID="Finalize the Co-Processor " DIR="LTR">
                        <P STYLE="margin-top: 0.3in; margin-bottom: 0.08in; page-break-after: avoid">
                        <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5>Finalize the
                        Co-Processor </FONT></FONT>
                        </P>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>Finalization entails
                        calling vtkCPProcessor::Finalize() and cleaning up any remaining
                        VTK objects by calling Delete(); </FONT></FONT>
                        </P>
                        <P STYLE="margin-bottom: 0.2in; border-top: none; border-bottom: 1.10pt double #808080; border-left: none; border-right: none; padding: 0in">
                        <BR><BR>
                        </P>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>While initially
                        there may seem to be a significant hurdle to overcome in order to
                        implement the adaptor for co-processing, the user only needs to
                        know enough information to create the VTK data objects from their
                        own simulation data structures. The adaptor can be made
                        computationally efficient by taking advantage of intimate
                        knowledge of the simulation code and knowing that VTK filters will
                        not modify input data. Examples include: </FONT></FONT>
                        </P>
                        <UL>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>Only creating the
                                VTK grid in the first call to the adaptor if the grid is not
                                changing topologically or geometrically. </FONT></FONT>
                                </P>
                                <LI><P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>Using the
                                SetArray() method to build vtkDataArray objects that use existing
                                memory used by the simulation code instead of allocating and
                                copying existing memory. </FONT></FONT>
                                </P>
                        </UL>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <BR><BR>
                        </P>
                        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>Finally, we suggest
                        looking at either the C++ <A HREF="http://paraview.org/Wiki/index.php?title=Coprocessing_example">coprocessing
                        example</A> and/or the <A HREF="http://paraview.org/Wiki/index.php?title=Python_coprocessing_example">python
                        coprocessing example</A> to see how the entire co-processing flow
                        works. Additonally, the code in
                        ParaView3/CoProcessing/CoProcessor/Testing/Cxx/PythonScriptCoProcessingExample.cxx
                        is also worth a look. This is used to test the co-processing
                        library and can be run with the command &quot;ctest -R
                        CoProcessing&quot;.</FONT></FONT></P>
                </DIV>
        </DIV>
</DIV>
<DIV ID=" C++ CoProcessing example" DIR="LTR">
        <P STYLE="margin-bottom: 0.15in; page-break-after: avoid"><FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=6>C++
        CoProcessing example</FONT></FONT></P>
        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>This example is used
        to demonstrate how the co-processing library can be used with a C++
        based simulation code. In the
        ParaView/CoProcessing/Adaptors/FortranAdaptors directory there is
        code useful for integrating C or Fortran based simulation codes
        withthe co-processing library. Note that this example requires MPI
        to be available on your system. The executable takes in a python
        coprocessing script and a number of time steps to be run for. Note
        to remember to set your system environment properly. See [<A HREF="http://paraview.org/Wiki/ParaView/Python_Scripting#Getting_Started">[5]</A>]
        for details. </FONT></FONT>
        </P>
        <DIV ID="CoProcessingExample.cxx" DIR="LTR">
                <P STYLE="margin-top: 0.3in; margin-bottom: 0.15in; page-break-after: avoid">
                <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5 STYLE="font-size: 20pt">CoProcessingExample.cxx</FONT></FONT></P>
                <P STYLE="margin-left: 0.25in; margin-right: 0.25in; margin-top: 0.25in; margin-bottom: 0.25in; background: #e6e6e6; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu mono, monospace"><FONT SIZE=2>#include
                &quot;vtkCPDataDescription.h&quot;<BR>#include
                &quot;vtkCPInputDataDescription.h&quot;<BR>#include
                &quot;vtkCPProcessor.h&quot;<BR>#include
                &quot;vtkCPPythonScriptPipeline.h&quot;<BR>#include
                &quot;vtkElevationFilter.h&quot;<BR>#include
                &quot;vtkMultiProcessController.h&quot;<BR>#include
                &quot;vtkPolyData.h&quot;<BR>#include &quot;vtkSmartPointer.h&quot;<BR>#include
                &quot;vtkSphereSource.h&quot;<BR>#include
                &quot;vtkXMLUnstructuredGridReader.h&quot;<BR><BR>#include
                &lt;mpi.h&gt;<BR>#include &lt;string&gt;<BR><BR>class DataGenerator
                {<BR>public:<BR>  DataGenerator()<BR>    {<BR>    this-&gt;Sphere =
                vtkSmartPointer&lt;vtkSphereSource&gt;::New();<BR>
                this-&gt;Sphere-&gt;SetThetaResolution(30);<BR>
                this-&gt;Sphere-&gt;SetPhiResolution(30);<BR>    int procId;<BR>
                MPI_Comm_rank(MPI_COMM_WORLD, &amp;procId);<BR>
                this-&gt;Sphere-&gt;SetCenter(procId*4.0, 0, 0);<BR>
                this-&gt;Elevation = vtkSmartPointer&lt;vtkElevationFilter&gt;::New();<BR>

                this-&gt;Elevation-&gt;SetInputConnection(this-&gt;Sphere-&gt;GetOutputPort());<BR>
                   this-&gt;Index = 0;<BR>    }<BR><BR>
                vtkSmartPointer&lt;vtkPolyData&gt; GetNext()<BR>    {<BR>    double
                radius = fabs(sin(0.1 * this-&gt;Index));<BR>    this-&gt;Index++;<BR>
                   this-&gt;Sphere-&gt;SetRadius(1.0 + radius);<BR>
                this-&gt;Elevation-&gt;Update();<BR>
                vtkSmartPointer&lt;vtkPolyData&gt; ret =
                vtkSmartPointer&lt;vtkPolyData&gt;::New();<BR>
                ret-&gt;DeepCopy(this-&gt;Elevation-&gt;GetOutput());<BR>    return
                ret;<BR>    }<BR><BR>protected:<BR>  int Index;<BR>
                vtkSmartPointer&lt;vtkSphereSource&gt; Sphere;<BR>
                vtkSmartPointer&lt;vtkElevationFilter&gt; Elevation;<BR>};<BR><BR>int
                main(int argc, char* argv[])<BR>{<BR>  if (argc &lt; 3)<BR>    {<BR>
                   printf(&quot;Usage: %s &lt;cp python file&gt; &lt;number of
                steps&gt;\n&quot;, argv[0]);<BR>    return 1;<BR>    }<BR>  // we
                assume that this is done in parallel<BR>  MPI_Init(&amp;argc,
                &amp;argv);<BR><BR>  std::string cpPythonFile = argv[1];<BR>  int
                nSteps = atoi(argv[2]);<BR><BR>  vtkCPProcessor* processor =
                vtkCPProcessor::New();<BR>  processor-&gt;Initialize();<BR>
                vtkCPPythonScriptPipeline* pipeline =
                vtkCPPythonScriptPipeline::New();<BR><BR>  // read the coprocessing
                python file<BR>  if(pipeline-&gt;Initialize(cpPythonFile.c_str())
                == 0)<BR>    {<BR>    cout &lt;&lt; &quot;Problem reading the
                python script.\n&quot;;<BR>    return 1;<BR>    }<BR><BR>
                processor-&gt;AddPipeline(pipeline);<BR>  pipeline-&gt;Delete();<BR><BR>
                 if (nSteps == 0)<BR>    {<BR>    return 0;<BR>    }<BR><BR>  //
                create a data source, typically this will come from the adaptor<BR>
                 // but here we use generator to create it ourselves<BR>
                DataGenerator generator;<BR><BR>  // do coprocessing<BR>  double
                tStart = 0.0;<BR>  double tEnd = 1.0;<BR>  double stepSize = (tEnd
                - tStart)/nSteps;<BR><BR>  vtkCPDataDescription* dataDesc =
                vtkCPDataDescription::New();<BR>  dataDesc-&gt;AddInput(&quot;input&quot;);<BR><BR>
                 for (int i = 0; i &lt; nSteps; ++i)<BR>    {<BR>    double
                currentTime = tStart + stepSize*i;<BR>    // set the current time
                and time step<BR>    dataDesc-&gt;SetTimeData(currentTime, i);<BR><BR>
                   // check if the script says we should do coprocessing now<BR>
                if(processor-&gt;RequestDataDescription(dataDesc) != 0)<BR>      {<BR>
                     // we are going to do coprocessing so use generator to<BR>
                 // create our grid at this timestep and provide it to<BR>      //
                the coprocessing library<BR>      vtkSmartPointer&lt;vtkDataObject&gt;
                dataObject =<BR>        generator.GetNext();<BR><BR>
                dataDesc-&gt;GetInputDescriptionByName(&quot;input&quot;)-&gt;SetGrid(dataObject);<BR>
                     processor-&gt;CoProcess(dataDesc);<BR>      }<BR>    }<BR><BR>
                 dataDesc-&gt;Delete();<BR>  processor-&gt;Finalize();<BR>
                processor-&gt;Delete();<BR><BR>  MPI_Finalize();<BR><BR>  return
                0;<BR>}</FONT></FONT></P>
        </DIV>
        <DIV ID="CMakeLists.txt" DIR="LTR">
                <P STYLE="margin-top: 0.3in; margin-bottom: 0.15in; page-break-after: avoid">
                <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5 STYLE="font-size: 20pt">CMakeLists.txt</FONT></FONT></P>
                <P STYLE="margin-left: 0.25in; margin-right: 0.25in; margin-top: 0.25in; margin-bottom: 0.25in; background: #e6e6e6; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu mono, monospace"><FONT SIZE=2>cmake_minimum_required(VERSION
                2.6)<BR><BR>PROJECT(CoProcessingExample)<BR><BR>FIND_PACKAGE(ParaView
                REQUIRED)<BR>INCLUDE(${PARAVIEW_USE_FILE})<BR><BR>FIND_PACKAGE(MPI
                REQUIRED)<BR>INCLUDE_DIRECTORIES(${MPI_INCLUDE_PATH})<BR><BR>ADD_EXECUTABLE(CoProcessingExample
                CoProcessingExample.cxx)<BR>TARGET_LINK_LIBRARIES(CoProcessingExample
                vtkCoProcessor)</FONT></FONT></P>
        </DIV>
        <DIV ID="Python Scripts" DIR="LTR">
                <P STYLE="margin-top: 0.3in; margin-bottom: 0.15in; page-break-after: avoid">
                <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5 STYLE="font-size: 20pt">Python
                Scripts</FONT></FONT></P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>The first python
                script below is used to just output the actual results of the
                example. This would correspond to a simulation run with a coarse
                grid in order to set up coprocessing runs for larger grids where
                outputting the entire simulation results can be computationally
                prohibitive. </FONT></FONT>
                </P>
                <P STYLE="margin-left: 0.25in; margin-right: 0.25in; margin-top: 0.25in; margin-bottom: 0.25in; background: #e6e6e6; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu mono, monospace"><FONT SIZE=2>try:
                paraview.simple<BR>except: from paraview.simple import *<BR>cp_writers
                = []<BR><BR>def RequestDataDescription(datadescription):<BR>
                &quot;Callback to populate the request for current timestep&quot;<BR>
                   timestep = datadescription.GetTimeStep()<BR>    input_name =
                'input'<BR>    if (timestep % 1 == 0) :<BR>
                datadescription.GetInputDescriptionByName(input_name).AllFieldsOn()<BR>

                datadescription.GetInputDescriptionByName(input_name).GenerateMeshOn()<BR>
                   else:<BR>
                datadescription.GetInputDescriptionByName(input_name).AllFieldsOff()<BR>

                datadescription.GetInputDescriptionByName(input_name).GenerateMeshOff()<BR><BR>def
                DoCoProcessing(datadescription):<BR>    &quot;Callback to do
                co-processing for current timestep&quot;<BR>    global cp_writers<BR>
                   cp_writers = []<BR>    timestep =
                datadescription.GetTimeStep()<BR><BR>    Sphere1 = CreateProducer(
                datadescription, &quot;input&quot; )<BR>    ParallelPolyDataWriter1
                = CreateWriter( XMLPPolyDataWriter, &quot;input_grid_%t.pvtp&quot;,
                1 )<BR><BR>    for writer in cp_writers:<BR>        if timestep %
                writer.cpFrequency == 0:<BR>            writer.FileName =
                writer.cpFileName.replace(&quot;%t&quot;, str(timestep))<BR>
                    writer.UpdatePipeline()<BR><BR>    # explicitly delete the
                proxies -- we do it this way to avoid problems with prototypes<BR>
                  tobedeleted = GetProxiesToDelete()<BR>    while len(tobedeleted)
                &gt; 0:<BR>        Delete(tobedeleted[0])<BR>        tobedeleted =
                GetProxiesToDelete()<BR><BR>def GetProxiesToDelete():<BR>    iter =
                servermanager.vtkSMProxyIterator()<BR>    iter.Begin()<BR>
                tobedeleted = []<BR>    while not iter.IsAtEnd():<BR>      if
                iter.GetGroup().find(&quot;prototypes&quot;) != -1:<BR>
                iter.Next()<BR>         continue<BR>      proxy =
                servermanager._getPyProxy(iter.GetProxy())<BR>      proxygroup =
                iter.GetGroup()<BR>      iter.Next()<BR>      if proxygroup !=
                'timekeeper' and proxy != None and
                proxygroup.find(&quot;pq_helper_proxies&quot;) == -1 :<BR>
                tobedeleted.append(proxy)<BR><BR>    return tobedeleted<BR><BR>def
                CreateProducer(datadescription, gridname):<BR>  &quot;Creates a
                producer proxy for the grid&quot;<BR>  if not
                datadescription.GetInputDescriptionByName(gridname):<BR>    raise
                RuntimeError, &quot;Simulation input name '%s' does not exist&quot;
                % gridname<BR>  grid =
                datadescription.GetInputDescriptionByName(gridname).GetGrid()<BR>
                producer = TrivialProducer()<BR>
                producer.GetClientSideObject().SetOutput(grid)<BR>
                producer.UpdatePipeline()<BR>  return producer<BR><BR>def
                CreateWriter(proxy_ctor, filename, freq):<BR>    global cp_writers<BR>
                   writer = proxy_ctor()<BR>    writer.FileName = filename<BR>
                writer.add_attribute(&quot;cpFrequency&quot;, freq)<BR>
                writer.add_attribute(&quot;cpFileName&quot;, filename)<BR>
                cp_writers.append(writer)<BR>    return writer</FONT></FONT></P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <BR><BR>
                </P>
                <P STYLE="margin-bottom: 0.2in; border-top: none; border-bottom: 1.10pt double #808080; border-left: none; border-right: none; padding: 0in">
                <BR><BR>
                </P>
                <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>This second script is
                still rather simple and only performs a cut on the input from the
                simulation code. It demonstrates though how desired results can be
                obtained while performing coprocessing at specified time steps. </FONT></FONT>
                </P>
                <P STYLE="margin-left: 0.25in; margin-right: 0.25in; margin-top: 0.25in; margin-bottom: 0.25in; background: #e6e6e6; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu mono, monospace"><FONT SIZE=2>try:
                paraview.simple<BR>except: from paraview.simple import *<BR>cp_writers
                = []<BR><BR>def RequestDataDescription(datadescription):<BR>
                &quot;Callback to populate the request for current timestep&quot;<BR>
                   timestep = datadescription.GetTimeStep()<BR>    input_name =
                'input'<BR>    if (timestep % 5 == 0) :<BR>
                datadescription.GetInputDescriptionByName(input_name).AllFieldsOn()<BR>

                datadescription.GetInputDescriptionByName(input_name).GenerateMeshOn()<BR>
                   else:<BR>
                datadescription.GetInputDescriptionByName(input_name).AllFieldsOff()<BR>

                datadescription.GetInputDescriptionByName(input_name).GenerateMeshOff()<BR><BR>def
                DoCoProcessing(datadescription):<BR>    &quot;Callback to do
                co-processing for current timestep&quot;<BR>    global cp_writers<BR>
                   cp_writers = []<BR>    timestep =
                datadescription.GetTimeStep()<BR><BR>    filename_0_pvtp =
                CreateProducer( datadescription, &quot;input&quot; )<BR><BR>
                Clip2 = Clip( guiName=&quot;Clip2&quot;, InsideOut=0,
                UseValueAsOffset=0, Scalars=['POINTS', 'Elevation'], Value=0.0,
                ClipType=&quot;Plane&quot; )<BR>    Clip2.ClipType.Normal = [0.0,
                1.0, 0.0]<BR>    Clip2.ClipType.Origin = [1.9999999105930328, 0.0,
                0.0]<BR>    Clip2.ClipType.Offset = 0.0<BR><BR>
                ParallelUnstructuredGridWriter2 = CreateWriter(
                XMLPUnstructuredGridWriter, &quot;Cut_%t.pvtu&quot;, 5 )<BR>    for
                writer in cp_writers:<BR>        if timestep % writer.cpFrequency
                == 0:<BR>            writer.FileName =
                writer.cpFileName.replace(&quot;%t&quot;, str(timestep))<BR>
                    writer.UpdatePipeline()<BR><BR>    # explicitly delete the
                proxies -- we do it this way to avoid problems with prototypes<BR>
                  tobedeleted = GetProxiesToDelete()<BR>    while len(tobedeleted)
                &gt; 0:<BR>        Delete(tobedeleted[0])<BR>        tobedeleted =
                GetProxiesToDelete()<BR><BR>def GetProxiesToDelete():<BR>    iter =
                servermanager.vtkSMProxyIterator()<BR>    iter.Begin()<BR>
                tobedeleted = []<BR>    while not iter.IsAtEnd():<BR>      if
                iter.GetGroup().find(&quot;prototypes&quot;) != -1:<BR>
                iter.Next()<BR>         continue<BR>      proxy =
                servermanager._getPyProxy(iter.GetProxy())<BR>      proxygroup =
                iter.GetGroup()<BR>      iter.Next()<BR>      if proxygroup !=
                'timekeeper' and proxy != None and
                proxygroup.find(&quot;pq_helper_proxies&quot;) == -1 :<BR>
                tobedeleted.append(proxy)<BR><BR>    return tobedeleted<BR><BR>def
                CreateProducer(datadescription, gridname):<BR>  &quot;Creates a
                producer proxy for the grid&quot;<BR>  if not
                datadescription.GetInputDescriptionByName(gridname):<BR>    raise
                RuntimeError, &quot;Simulation input name '%s' does not exist&quot;
                % gridname<BR>  grid =
                datadescription.GetInputDescriptionByName(gridname).GetGrid()<BR>
                producer = TrivialProducer()<BR>
                producer.GetClientSideObject().SetOutput(grid)<BR>
                producer.UpdatePipeline()<BR>  return producer<BR><BR>def
                CreateWriter(proxy_ctor, filename, freq):<BR>    global cp_writers<BR>
                   writer = proxy_ctor()<BR>    writer.FileName = filename<BR>
                writer.add_attribute(&quot;cpFrequency&quot;, freq)<BR>
                writer.add_attribute(&quot;cpFileName&quot;, filename)<BR>
                cp_writers.append(writer)<BR>    return writer</FONT></FONT></P>
        </DIV>
</DIV>
<DIV ID=" Python CoProcessing Example " DIR="LTR">
        <P STYLE="margin-bottom: 0.15in; page-break-after: avoid"><FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=6>Python
        CoProcessing Example </FONT></FONT>
        </P>
        <P LANG="en-US" ALIGN=LEFT STYLE="margin-top: 0.04in; margin-bottom: 0.05in; page-break-inside: avoid; widows: 3">
        <FONT FACE="DejaVu Serif, serif"><FONT SIZE=3>This example is used
        to demonstrate how the co-processing library can be used with a
        python based simulation code. Note that this example requires MPI to
        be available on your system as well as pyMPI to initialize and
        finalize MPI from the python script. The executable takes in a
        python co-processing script and a number of time steps to be run
        for. Note to remember to set your system environment properly. See
        [<A HREF="http://paraview.org/Wiki/ParaView/Python_Scripting#Getting_Started">[6]</A>]
        for details. </FONT></FONT>
        </P>
        <DIV ID="Python driver code " DIR="LTR">
                <P STYLE="margin-top: 0.3in; margin-bottom: 0.15in; page-break-after: avoid">
                <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5 STYLE="font-size: 20pt">Python
                driver code </FONT></FONT>
                </P>
                <P STYLE="margin-left: 0.25in; margin-right: 0.25in; margin-top: 0.25in; margin-bottom: 0.25in; background: #e6e6e6; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu mono, monospace"><FONT SIZE=2>import sys<BR>if
                len(sys.argv) != 3:<BR>    print &quot;command is 'pyMPI &lt;python
                driver code&gt; &lt;script name&gt; &lt;number of time steps&gt;'&quot;<BR>
                   sys.exit(1)<BR>import mpi<BR>mpi.initialized()<BR>import
                paraview<BR>import paraview.vtk as vtk<BR><BR># initialize and read
                input parameters<BR>paraview.options.batch =
                True<BR>paraview.options.symmetric = True<BR><BR>def
                _refHolderMaker(obj):<BR>    def _refHolder(obj2, string):<BR>
                  tmp = obj<BR>    return _refHolder<BR><BR>def coProcess(grid,
                time, step, scriptname):<BR>    import vtkCoProcessorPython #
                import libvtkCoProcessorPython for older PV versions<BR>    if
                scriptname.endswith(&quot;.py&quot;):<BR>        scriptname =
                scriptname.rstrip(&quot;.py&quot;)<BR>    try:<BR>        cpscript
                = __import__(scriptname)<BR>    except:<BR>        print 'Cannot
                find ', scriptname, ' -- no coprocessing will be performed.'<BR>
                    return<BR><BR>    datadescription =
                vtkCoProcessorPython.vtkCPDataDescription()<BR>
                datadescription.SetTimeData(time, step)<BR>
                datadescription.AddInput(&quot;input&quot;)<BR>
                cpscript.RequestDataDescription(datadescription)<BR>
                inputdescription =
                datadescription.GetInputDescriptionByName(&quot;input&quot;)<BR>
                if inputdescription.GetIfGridIsNecessary() == False:<BR>
                return<BR><BR>    inputdescription.SetGrid(grid)<BR>
                cpscript.DoCoProcessing(datadescription)<BR><BR>try:<BR>
                numsteps = int(sys.argv[2])<BR>except ValueError:<BR>    print 'the
                last argument should be a number'<BR>    numsteps = 10<BR><BR><BR>for
                step in range(numsteps):<BR>    # assume simulation time starts at
                0<BR>    time = step/float(numsteps)<BR><BR>    # create the input
                to the coprocessing library.  normally<BR>    # this will come from
                the adaptor<BR>    imageData = vtk.vtkImageData()<BR>
                imageData.SetOrigin(0, 0, 0)<BR>    imageData.SetSpacing(.1, .1,
                .1)<BR>    imageData.SetDimensions(10, 12, 12)<BR>    pointArray =
                vtk.vtkDoubleArray()<BR>
                pointArray.SetNumberOfTuples(imageData.GetNumberOfPoints())<BR>
                for i in range(imageData.GetNumberOfPoints()):<BR>
                pointArray.SetValue(i, i)<BR>    pointArray.SetName(&quot;pointData&quot;)<BR>
                   imageData.GetPointData().AddArray(pointArray)<BR><BR>    #
                &quot;perform&quot; coprocessing.  results are outputted only if<BR>
                   # the passed in script says we should at time/step<BR>
                coProcess(imageData, time, step, sys.argv[1])<BR><BR>mpi.finalized()</FONT></FONT></P>
        </DIV>
        <DIV ID="Sample coprocessing script " DIR="LTR">
                <P STYLE="margin-top: 0.3in; margin-bottom: 0.15in; page-break-after: avoid">
                <FONT FACE="DejaVu Sans, sans-serif"><FONT SIZE=5 STYLE="font-size: 20pt">Sample
                coprocessing script </FONT></FONT>
                </P>
                <P STYLE="margin-left: 0.25in; margin-right: 0.25in; margin-top: 0.25in; margin-bottom: 0.25in; background: #e6e6e6; page-break-inside: avoid; widows: 3">
                <FONT FACE="DejaVu mono, monospace"><FONT SIZE=2>try:
                paraview.simple<BR>except: from paraview.simple import *<BR>cp_writers
                = []<BR><BR>def RequestDataDescription(datadescription):<BR>
                &quot;Callback to populate the request for current timestep&quot;<BR>
                   timestep = datadescription.GetTimeStep()<BR>    input_name =
                'input'<BR>    if (timestep % 1 == 0) :<BR>
                datadescription.GetInputDescriptionByName(input_name).AllFieldsOn()<BR>

                datadescription.GetInputDescriptionByName(input_name).GenerateMeshOn()<BR>
                   else:<BR>
                datadescription.GetInputDescriptionByName(input_name).AllFieldsOff()<BR>

                datadescription.GetInputDescriptionByName(input_name).GenerateMeshOff()<BR><BR>def
                DoCoProcessing(datadescription):<BR>    &quot;Callback to do
                co-processing for current timestep&quot;<BR>    global cp_writers<BR>
                   cp_writers = []<BR>    timestep =
                datadescription.GetTimeStep()<BR><BR>    Sphere1 = CreateProducer(
                datadescription, &quot;input&quot; )<BR>    ImageWriter1 =
                CreateWriter( XMLPImageDataWriter, &quot;input_grid_%t.pvti&quot;,
                1 )<BR><BR>    for writer in cp_writers:<BR>        if timestep %
                writer.cpFrequency == 0:<BR>            writer.FileName =
                writer.cpFileName.replace(&quot;%t&quot;, str(timestep))<BR>
                    writer.UpdatePipeline()<BR><BR>    # explicitly delete the
                proxies -- we do it this way to avoid problems with prototypes<BR>
                  tobedeleted = GetProxiesToDelete()<BR>    while len(tobedeleted)
                &gt; 0:<BR>        Delete(tobedeleted[0])<BR>        tobedeleted =
                GetProxiesToDelete()<BR><BR>def GetProxiesToDelete():<BR>    iter =
                servermanager.vtkSMProxyIterator()<BR>    iter.Begin()<BR>
                tobedeleted = []<BR>    while not iter.IsAtEnd():<BR>      if
                iter.GetGroup().find(&quot;prototypes&quot;) != -1:<BR>
                iter.Next()<BR>         continue<BR>      proxy =
                servermanager._getPyProxy(iter.GetProxy())<BR>      proxygroup =
                iter.GetGroup()<BR>      iter.Next()<BR>      if proxygroup !=
                'timekeeper' and proxy != None and
                proxygroup.find(&quot;pq_helper_proxies&quot;) == -1 :<BR>
                tobedeleted.append(proxy)<BR><BR>    return tobedeleted<BR><BR>def
                CreateProducer(datadescription, gridname):<BR>  &quot;Creates a
                producer proxy for the grid&quot;<BR>  if not
                datadescription.GetInputDescriptionByName(gridname):<BR>    raise
                RuntimeError, &quot;Simulation input name '%s' does not exist&quot;
                % gridname<BR>  grid =
                datadescription.GetInputDescriptionByName(gridname).GetGrid()<BR>
                producer = TrivialProducer()<BR>
                producer.GetClientSideObject().SetOutput(grid)<BR>
                producer.UpdatePipeline()<BR>  return producer<BR><BR>def
                CreateWriter(proxy_ctor, filename, freq):<BR>    global cp_writers<BR>
                   writer = proxy_ctor()<BR>    writer.FileName = filename<BR>
                writer.add_attribute(&quot;cpFrequency&quot;, freq)<BR>
                writer.add_attribute(&quot;cpFileName&quot;, filename)<BR>
                cp_writers.append(writer)<BR>    return writer</FONT></FONT></P>
        </DIV>
</DIV>

</BODY>
</HTML>
